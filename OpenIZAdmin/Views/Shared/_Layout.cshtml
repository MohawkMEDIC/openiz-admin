<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - OpenIZ Administration</title>
    @Styles.Render("~/Content/css")

    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <div class="navigation navbar navbar-fixed-top">
        <div class="container-fluid navbar-inner">
            <nav>
                <a class="logo" href="/">
                    <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
                    OpenIZ Administration
                </a>
                <ul class="nav pull-right">
                    <li>
                        @Html.Partial("_LoginPartial")
                    </li>
                </ul>
                @if (Request.IsAuthenticated && Request.Cookies["access_token"]?.Value != null)
                {
                    <ul class="nav navbar-nav pull-right">
                        <li>
                            <a href="@Url.Action("Create", "Alert")">
                                <span class="glyphicon glyphicon-plus">
                                </span><span id="create-alert"></span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="alert-modal-toggle" id="alert-modal-button" data-toggle="modal" data-target="#alert-modal" role="button">
                                <span class="glyphicon glyphicon-bell">
                                </span><span id="new-alerts"></span>
                            </a>
                        </li>
                    </ul>}
                <ul class="nav pull-right" role="menu" aria-labelledby="menu">
                    <li class="dropdown" id="language-change-dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                            <span class="glyphicon glyphicon-globe"></span> @OpenIZAdmin.Localization.Locale.ChangeLanguage <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#" language="@Locale.EN" class="change-language">
                                    @Locale.English
                                </a>
                            </li>
                            <li>
                                <a href="#" language="@Locale.SW" class="change-language">
                                    Kiswahili
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <div id="main-content" class="container-fluid">
        <div class="row">

            <!-- Sidebar -->
            <div class="col-sm-3 col-md-2 sidebar">

                <ul class="nav nav-sidebar">
                    <li><a href="/Home"><span class="glyphicon glyphicon-home" aria-hidden="true"></span> @Locale.Dashboard</a></li>
                    @if (User.Identity.IsAuthenticated && Request.Cookies["access_token"]?.Value != null)
                    {
                        <li><a href="/Applet"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span> @Locale.Applets</a></li>
                        <li><a href="/Application"><span class="glyphicon glyphicon-star" aria-hidden="true"></span> @Locale.Applications</a></li>
                        <li><a href="/AssigningAuthority"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span> @Locale.AssigningAuthorities</a></li>
                        @*<li><a href="/Certificate"><span class="glyphicon glyphicon-certificate" aria-hidden="true"></span> @Locale.Certificates</a></li>*@
                        <li><a href="/Concept"><span class="glyphicon glyphicon-compressed" aria-hidden="true"></span> @Locale.Concepts</a></li>
                        <li><a href="/Device"><span class="glyphicon glyphicon-phone" aria-hidden="true"></span> @Locale.Devices</a></li>
                        <li><a href="/Material"><span class="glyphicon glyphicon-oil" aria-hidden="true"></span> @Locale.Material</a></li>
                        <li><a href="/Place"><span class="glyphicon glyphicon-globe" aria-hidden="true"></span> @Locale.Places</a></li>
                        <li><a href="/Policy"><span class="glyphicon glyphicon-cloud" aria-hidden="true"></span> @Locale.Policies</a></li>
                        @*<li><a href="/Provider"><span class="glyphicon glyphicon-heart" aria-hidden="true"></span> @Locale.Providers</a></li>*@
                        <li><a href="/Realm"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> @Locale.RealmManagement</a></li>
                        <li><a href="/Role"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> @Locale.Roles</a></li>
                        <li><a href="/User"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> @Locale.Users</a></li>
                        <li><a href="/Home/VersionInformation"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> @Locale.About</a></li>}
                </ul>
            </div>

            <div id="alert-partial-container">
            </div>

            <div class="content col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main row">
                @RenderBody()
            </div>


        </div>
        <div class="content col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main row">
            <hr />
            <footer>
                <p>&copy; @DateTime.Now.Year - OpenIZ Administration</p>
            </footer>
        </div>
    </div>

    <input type="hidden" id="success" value="@TempData["success"]" />
    <input type="hidden" id="info" value="@TempData["info"]" />
    <input type="hidden" id="warning" value="@TempData["warning"]" />
    <input type="hidden" id="error" value="@TempData["error"]" />

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryajax")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/toastr")
    @Scripts.Render("~/bundles/moment")
    @Scripts.Render("~/bundles/datatables")
    @Scripts.Render("~/bundles/select2")
    @Scripts.Render("~/bundles/ajax-search")



    @RenderSection("scripts", required: false)
    <script type="text/javascript">

        $("#language-change-dropdown").on('click', function (event) {
            var attr = $(this).attr("class");

            if (attr === "dropdown open") {
                $(this).attr("class", "dropdown");
            } else {
                $(this).attr("class", "dropdown open");
            }
        });

        $("#profile-change-dropdown").on('click', function (event) {
            var attr = $(this).attr("class");

            if (attr === "dropdown open") {
                $(this).attr("class", "dropdown");
            } else {
                $(this).attr("class", "dropdown open");
            }
        });

        $(".change-language").on('click', function () {
            var language = $(this).attr("language");
            console.log(language);

            document.cookie = "__openiz_language=" + language;

            $.ajax({
                url: "/Locale/ChangeLanguage?language=" + language,
                success: function (data) {
                    console.log(data);
                    window.location.reload();
                },
                error: function (error) {
                    console.log(error);
                },
                type: "POST"
            });
        });

        $("#alert-modal-button").on('click', function () {
            $.ajax({
                url: "/Alert/GetAlerts",
                success: function (data) {
                    $('.modal-backdrop').first().remove();
                    $('#alert-partial-container').html(data);
                    $('#alert-modal').modal("show");
                },
                error: function (error) {
                    console.log(error);
                },
                type: "GET"
            });
        });

        $("#create-alert-modal-button").on('click', function () {
            $.ajax({
                url: "/Alert/CreateAlert",
                success: function (data) {
                    $('.modal-backdrop').first().remove();
                    $('#alert-partial-container').html(data);
                    $('#create-alert-modal').modal("show");
                },
                error: function (error) {
                    console.log(error);
                },
                type: "GET"
            });
        });

        $(document).ready(function () {
            newAlerts();
        });

        window.setInterval(newAlerts(), 5000);

        function newAlerts() {
            $.ajax({
                url: "/Alert/NewAlerts",
                success: function (data) {
                    $('#new-alerts').html(data);
                },
                error: function (error) {
                    console.log(error);
                },
                type: "GET"
            });
        }

        $(document).ready(function () {
            $("#reset").on("click", function () {
                $("#SearchTerm").val('');
                window.location.reload();
            });
        });

        function hideLoadingBar() {
            $("#loading-bar").hide();
        }

        function showLoadingBar() {
            $("#loading-bar").show();
        }

    </script>
</body>
</html>

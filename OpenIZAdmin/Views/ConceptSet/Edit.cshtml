@model OpenIZAdmin.Models.ConceptSetModels.EditConceptSetModel
@{
    ViewBag.Title = Locale.ConceptSet;
}

<div>
    @using (Html.BeginForm("Edit", "ConceptSet", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "form-horizontal", role = "form", @id="editForm" }))
    {
        <div class="panel panel-default">
            <div class="panel panel-heading">
                <span class="text-white">@Locale.ConceptSet @Model.Mnemonic</span>
            </div>
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="panel panel-body panel-default">
                @Html.HiddenFor(m => m.Key)
                @Html.HiddenFor(m => m.ConceptToAdd, new { id = "conceptToAdd" })
                @Html.LabelFor(m => m.Mnemonic, new { @class = "control-label" })
                @Html.TextBoxFor(m => m.Mnemonic, new { @class = "form-control" })
                @Html.LabelFor(m => m.Oid, new { @class = "control-label" })
                @Html.TextBoxFor(m => m.Oid, new { @class = "form-control" })
                @Html.LabelFor(m => m.Name, new { @class = "control-label" })
                @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
                @Html.LabelFor(m => m.Url, new { @class = "control-label" })
                @Html.TextBoxFor(m => m.Url, new { @class = "form-control" })
            </div>
        </div>
        <div id="conceptList">
            @Html.Partial("_ConceptList")
        </div>
        <input type="submit" value="@Locale.Save" class="btn btn-default" />
        <div class="panel panel-default">
            <div class="panel panel-heading">
                <span class="text-white">@Locale.Concept @Locale.Search</span>
            </div>
            <div class="panel panel-body panel-default">
                @Html.LabelFor(m => m.ConceptMnemonic, new { @class = "control-label" })
                @Html.TextBoxFor(m => m.ConceptMnemonic, new { @class = "form-control" })
                @Html.LabelFor(m => m.ConceptName, new { @class = "control-label" })
                @Html.TextBoxFor(m => m.ConceptName, new { @class = "form-control" })
            </div>
            <input type="button" value="@Locale.Search" class="btn btn-default" id="searchConcepts" />
            </div>
            <div id="concept-search-results">
            </div>
            
            }

        </div>



@section scripts{
    <script>
        function addConcept(key, button) {
            $("#conceptToAdd").val(key);
            console.log(button);
            
            var dataForm = $('#editForm').serializeArray();
            var url = "/ConceptSet/Add";
            $.ajax({
                data: dataForm,
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                type: 'POST',
                cache: false,
                url: url,
                success: function (data) {
                    $('#conceptList').html(data);
                    $(button).parent().parent().remove();
                },
                error: function (err) {
                    console.log(err);
                }
            })

        };
        $(document).ready(function () {
            $("#searchConcepts").click(function(){
                searchConcepts();
            });
                function searchConcepts() {
                var dataForm = $('#editForm').serializeArray();
                $.ajax({
                    url: '@Url.Action("Search", "ConceptSet")',
                    cache: false,
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    type: "POST",
                    data: dataForm,
                    success: function (data) {
                        $('#concept-search-results').html(data);
                        $('#searchResults').DataTable();

                    },
                    error: function (reponse) {
                        alert("error : " + reponse);
                    }
                });

            };



        });
    </script>
}